<!DOCTYPE html>
<html>
<head>
  <title>PS5 Rental Dashboard</title>
  <meta charset="UTF-8" />
  <style>
    body { font-family: Arial; padding: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 10px; border: 1px solid #ccc; text-align: center; }
    .green { background: #c8f7c5; }
    .orange { background: #ffe6b5; }
    .red { background: #ffcccc; }
    button { padding: 5px 10px; margin: 2px; cursor: pointer; }
  </style>
</head>
<body>

<h2>PS5 Rental Dashboard</h2>
<p>This will load your Google Sheet data and show your PS5 stations.</p>

<table id="sessionTable">
  <thead>
    <tr>
      <th>Station</th>
      <th>Customer</th>
      <th>Start</th>
      <th>Time Remaining</th>
      <th>Status</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const API = "1MRk7U4pJNQoBsMO2KI0fRGUB19GNz4bpM6lohGKO5k0";

// Load sessions
async function loadSessions() {
  try {
    let res = await fetch(API);
    let data = await res.json();
    let tbody = document.querySelector("#sessionTable tbody");
    tbody.innerHTML = "";

    data.forEach(s => {
      let row = document.createElement("tr");
      let color = "";

      if (s.status == "Ongoing") color = "green";
      if (s.status == "Near End") color = "orange";
      if (s.status == "Ended") color = "red";

      row.innerHTML = `
        <td>${s.station}</td>
        <td>${s.customer}</td>
        <td>${s.startTime}</td>
        <td>${s.timeRemaining}</td>
        <td class="${color}">${s.status}</td>
        <td>
          <button onclick="action('${s.station}', 'pause')">Pause</button>
          <button onclick="action('${s.station}', 'resume')">Resume</button>
          <button onclick="action('${s.station}', 'stop')">Stop</button>
        </td>
      `;

      tbody.appendChild(row);
    });
  } catch (err) {
    console.error("Error loading data:", err);
  }
}

async function action(station, action) {
  await fetch(API, {
    method: "POST",
    body: JSON.stringify({ station, action })
  });
  loadSessions();
}

setInterval(loadSessions, 5000); // auto-refresh every 5 seconds
loadSessions();
</script>

</body>
</html>
